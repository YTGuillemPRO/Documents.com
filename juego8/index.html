<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Car Soccer 3D</title>
<style>
body {
  margin: 0;
  background: #062;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
canvas {
  background: linear-gradient(#1e8f4d, #0b6623);
  border: 3px solid white;
}
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const keys = {};
addEventListener("keydown", e => keys[e.key] = true);
addEventListener("keyup", e => keys[e.key] = false);

const FIELD = { width: canvas.width, height: 200, depth: 800 };
const FOV = 400;

const car = {
  x: FIELD.width / 2,
  y: 600,
  z: 0,
  angle: 0,
  speed: 0,
  vz: 0,
  radius: 18
};

const ball = {
  x: FIELD.width / 2,
  y: 400,
  z: 0,
  vx: 3,
  vy: -2,
  vz: 0,
  radius: 14
};

const GRAVITY = 0.6;
const FRICTION = 0.98;

// ================= PROYECCIÓN 3D =================
function project(x, y, z) {
  const scale = FOV / (FOV + y);
  return {
    x: (x - FIELD.width / 2) * scale + FIELD.width / 2,
    y: canvas.height - (y - z) * scale,
    scale
  };
}

// ================= LOOP =================
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

// ================= UPDATE =================
function update() {
  if (keys["w"]) car.speed += 0.3;
  if (keys["s"]) car.speed *= 0.9;
  if (keys["a"]) car.angle -= 0.05;
  if (keys["d"]) car.angle += 0.05;
  if (keys[" "] && car.z === 0) car.vz = 12;

  car.speed *= FRICTION;
  car.x += Math.cos(car.angle) * car.speed;
  car.y += Math.sin(car.angle) * car.speed;

  car.vz -= GRAVITY;
  car.z += car.vz;
  if (car.z < 0) { car.z = 0; car.vz = 0; }

  ball.vz -= GRAVITY * 0.5;
  ball.x += ball.vx;
  ball.y += ball.vy;
  ball.z += ball.vz;

  if (ball.z < 0) { ball.z = 0; ball.vz *= -0.6; }

  collide(car, ball);
}

// ================= COLISIÓN =================
function collide(c, b) {
  const dx = b.x - c.x;
  const dy = b.y - c.y;
  const dist = Math.hypot(dx, dy);
  if (dist < c.radius + b.radius) {
    const a = Math.atan2(dy, dx);
    b.vx = Math.cos(a) * c.speed * 2;
    b.vy = Math.sin(a) * c.speed * 2;
    b.vz = 6;
  }
}

// ================= DRAW =================
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // suelo
  ctx.fillStyle = "#1e8f4d";
  ctx.fillRect(0, canvas.height/2, canvas.width, canvas.height);

  drawObject(ball, "#fff");
  drawCar();
}

function drawObject(obj, color) {
  const p = project(obj.x, obj.y, obj.z);
  ctx.beginPath();
  ctx.arc(p.x, p.y, obj.radius * p.scale, 0, Math.PI * 2);
  ctx.fillStyle = color;
  ctx.fill();
}

function drawCar() {
  const p = project(car.x, car.y, car.z);
  ctx.save();
  ctx.translate(p.x, p.y);
  ctx.rotate(car.angle);
  ctx.scale(p.scale, p.scale);
  ctx.fillStyle = "#ff3b3b";
  ctx.fillRect(-20, -12, 40, 24);
  ctx.restore();
}
</script>

</body>
</html>
