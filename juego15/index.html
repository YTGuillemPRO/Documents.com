<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Call of Duty</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{overflow:hidden;background:#000;font-family:monospace}
#hud{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;color:#0f0}
#crosshair{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:28px}
#ammo,#health,#kills{position:absolute;padding:10px 15px;background:rgba(0,0,0,.7);border:2px solid}
#ammo{bottom:20px;right:20px}
#health{bottom:20px;left:20px;border-color:red;color:red}
#kills{top:20px;left:20px;border-color:yellow;color:yellow}
#menu,#gameover{
position:fixed;top:0;left:0;width:100%;height:100%;
display:flex;align-items:center;justify-content:center;
flex-direction:column;background:#000;z-index:10;color:white
}
button{padding:15px 40px;font-size:20px;font-weight:bold;cursor:pointer}
</style>
</head>

<body>

<div id="menu">
<h1>FPS 3D</h1>
<button onclick="startGame()">INICIAR</button>
<p>WASD mover | Rat√≥n mirar | Click disparar | R recargar</p>
</div>

<div id="gameover" style="display:none">
<h1>K.I.A.</h1>
<p id="final"></p>
<button onclick="location.reload()">REINTENTAR</button>
</div>

<div id="hud">
<div id="crosshair">+</div>
<div id="ammo">AMMO: <span id="ammoVal">30</span></div>
<div id="health">SALUD: <span id="healthVal">100</span></div>
<div id="kills">BAJAS: <span id="killVal">0</span></div>
</div>

<canvas id="c"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
let scene,camera,renderer
let yaw=new THREE.Object3D()
let pitch=new THREE.Object3D()
let raycaster=new THREE.Raycaster()

let player={health:100,ammo:30,maxAmmo:30,kills:0,reloading:false}
let enemies=[]
let keys={}
let mouse={x:0,y:0}
let playing=false
let weapon

function init(){
scene=new THREE.Scene()
scene.background=new THREE.Color(0x6d7b87)
scene.fog=new THREE.Fog(0x6d7b87,10,80)

camera=new THREE.PerspectiveCamera(75,innerWidth/innerHeight,0.1,500)

yaw.position.y=1.7
yaw.add(pitch)
pitch.add(camera)
scene.add(yaw)

renderer=new THREE.WebGLRenderer({canvas:c,antialias:true})
renderer.setSize(innerWidth,innerHeight)
renderer.shadowMap.enabled=true

let hemi=new THREE.HemisphereLight(0xffffff,0x444444,0.6)
scene.add(hemi)

let sun=new THREE.DirectionalLight(0xffffff,0.8)
sun.position.set(20,30,10)
sun.castShadow=true
scene.add(sun)

createGround()
createCity()
createWeapon()

addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true)
addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false)
addEventListener('mousemove',e=>{if(playing){mouse.x=e.movementX;mouse.y=e.movementY}})
addEventListener('click',shoot)
addEventListener('resize',onResize)

animate()
}

function createGround(){
let g=new THREE.PlaneGeometry(300,300)
let m=new THREE.MeshStandardMaterial({color:0x333333})
let ground=new THREE.Mesh(g,m)
ground.rotation.x=-Math.PI/2
ground.receiveShadow=true
scene.add(ground)
}

function createCity(){
for(let i=0;i<60;i++){
let w=3+Math.random()*6
let h=5+Math.random()*20
let d=3+Math.random()*6
let geo=new THREE.BoxGeometry(w,h,d)
let mat=new THREE.MeshStandardMaterial({color:0x777777})
let b=new THREE.Mesh(geo,mat)
b.position.set((Math.random()-0.5)*200,h/2,(Math.random()-0.5)*200)
b.castShadow=b.receiveShadow=true
scene.add(b)
}
}

function createWeapon(){
weapon=new THREE.Group()

let body=new THREE.Mesh(
new THREE.BoxGeometry(0.12,0.12,0.8),
new THREE.MeshStandardMaterial({color:0x222})
)
body.position.set(0.3,-0.3,-0.6)
weapon.add(body)

let barrel=new THREE.Mesh(
new THREE.CylinderGeometry(0.02,0.02,0.6),
new THREE.MeshStandardMaterial({color:0x111})
)
barrel.rotation.x=Math.PI/2
barrel.position.set(0.3,-0.3,-1)
weapon.add(barrel)

let grip=new THREE.Mesh(
new THREE.BoxGeometry(0.08,0.15,0.1),
new THREE.MeshStandardMaterial({color:0x333})
)
grip.position.set(0.3,-0.4,-0.4)
weapon.add(grip)

pitch.add(weapon)
}

function spawnEnemies(){
for(let i=0;i<8;i++){
let e=new THREE.Mesh(
new THREE.CapsuleGeometry(0.3,1.2),
new THREE.MeshStandardMaterial({color:0xaa0000})
)
e.position.set((Math.random()-0.5)*80,1,(Math.random()-0.5)*80)
e.castShadow=true
scene.add(e)
enemies.push({mesh:e,health:100})
}
}

function shoot(){
if(!playing||player.reloading||player.ammo<=0)return
player.ammo--
updateHUD()

weapon.position.z+=0.05
setTimeout(()=>weapon.position.z-=0.05,50)

raycaster.setFromCamera(new THREE.Vector2(0,0),camera)
let hits=raycaster.intersectObjects(enemies.map(e=>e.mesh))
if(hits.length){
let enemy=enemies.find(e=>e.mesh===hits[0].object)
enemy.health-=50
if(enemy.health<=0){
scene.remove(enemy.mesh)
enemies.splice(enemies.indexOf(enemy),1)
player.kills++
updateHUD()
}
}
}

function updatePlayer(){
let speed=0.15
let dir=new THREE.Vector3()
camera.getWorldDirection(dir)
dir.y=0;dir.normalize()
let right=new THREE.Vector3().crossVectors(camera.up,dir)

if(keys.w) yaw.position.add(dir.clone().multiplyScalar(speed))
if(keys.s) yaw.position.add(dir.clone().multiplyScalar(-speed))
if(keys.a) yaw.position.add(right.clone().multiplyScalar(speed))
if(keys.d) yaw.position.add(right.clone().multiplyScalar(-speed))

yaw.rotation.y-=mouse.x*0.002
pitch.rotation.x-=mouse.y*0.002
pitch.rotation.x=Math.max(-1.5,Math.min(1.5,pitch.rotation.x))
mouse.x=mouse.y=0
}

function updateEnemies(){
for(let e of enemies){
let dir=yaw.position.clone().sub(e.mesh.position)
let dist=dir.length()
dir.normalize()
if(dist>2)e.mesh.position.add(dir.multiplyScalar(0.03))
else{
player.health-=0.2
updateHUD()
if(player.health<=0)gameOver()
}
}
}

function updateHUD(){
ammoVal.textContent=player.ammo
healthVal.textContent=Math.max(0,player.health|0)
killVal.textContent=player.kills
}

function animate(){
requestAnimationFrame(animate)
if(playing){
updatePlayer()
updateEnemies()
}
renderer.render(scene,camera)
}

function startGame(){
menu.style.display='none'
playing=true
spawnEnemies()
document.body.requestPointerLock()
}

function gameOver(){
playing=false
final.textContent='BAJAS: '+player.kills
gameover.style.display='flex'
document.exitPointerLock()
}

function onResize(){
camera.aspect=innerWidth/innerHeight
camera.updateProjectionMatrix()
renderer.setSize(innerWidth,innerHeight)
}

window.onload=init
</script>
</body>
</html>
