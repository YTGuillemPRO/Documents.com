<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Low Poly Clicker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Courier New', monospace; background: #2c3e50; color: #ecf0f1; overflow: hidden; height: 100vh; }
        
        /* Contenedor Principal */
        .game-container { display: grid; grid-template-columns: 1fr 350px; height: 100vh; }
        
        /* Area de Juego Estilo Terreno Low Poly */
        .game-area { 
            background: #27ae60; /* Verde plano */
            position: relative; overflow: hidden;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.2);
        }

        /* Stats con estilo de bloques */
        .stats-top { 
            position: absolute; top: 20px; left: 20px; z-index: 100;
            background: #34495e; padding: 15px; border: 4px solid #2c3e50;
        }
        #money { font-size: 3rem; font-weight: 900; color: #f1c40f; text-shadow: 2px 2px 0px #d35400; }
        .badge-container { display: flex; gap: 5px; margin-top: 5px; }
        .tag { padding: 4px 8px; font-weight: bold; text-transform: uppercase; font-size: 0.7rem; }
        #multiplier-badge { background: #e67e22; color: #fff; }
        #rebirth-count { background: #8e44ad; color: #fff; }

        /* Botón Rebirth (Caja Geométrica) */
        .rebirth-btn {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 20px 30px; background: #9b59b6; border: none; border-bottom: 6px solid #8e44ad;
            color: white; font-weight: 800; cursor: pointer; display: none;
        }
        .rebirth-btn.available { display: block; }
        .rebirth-btn:active { border-bottom: 2px solid #8e44ad; transform: translate(-50%, 4px); }

        /* Tienda Estilo Menú de RPG Clásico */
        .shop-panel { background: #34495e; border-left: 6px solid #2c3e50; display: flex; flex-direction: column; }
        .shop-header { padding: 20px; background: #2c3e50; text-align: center; letter-spacing: 2px; }
        .shop-items { flex: 1; overflow-y: auto; padding: 10px; }
        .item {
            background: #ecf0f1; color: #2c3e50; margin-bottom: 8px; padding: 12px;
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
            border-bottom: 4px solid #bdc3c7; transition: 0.1s;
        }
        .item:hover { background: #fff; transform: scale(1.02); }
        .item:active { border-bottom: 0; transform: translateY(4px); }
        .item.locked { background: #95a5a6; opacity: 0.6; cursor: not-allowed; border-bottom: 4px solid #7f8c8d; }
        
        /* Gema/Moneda Low Poly (Hexagonal/Diamante) */
        .coin {
            position: absolute; width: 70px; height: 70px;
            background: #f1c40f; clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            border: none; cursor: pointer; z-index: 10;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 10px 0 #d35400;
        }
        /* Reflejo de la gema */
        .coin::after {
            content: ''; position: absolute; top: 10%; left: 10%; width: 30%; height: 30%;
            background: rgba(255,255,255,0.4); clip-path: polygon(0 0, 100% 0, 0 100%);
        }
    </style>
</head><body>
    <div class="game-container">
        <div class="game-area" id="gameArea">
            <div class="stats-top">
                <div id="money">$0</div>
                <div class="badge-container">
                    <span class="tag" id="multiplier-badge">x1.0</span>
                    <span class="tag" id="rebirth-count">0/5</span>
                </div>
            </div>
            <button id="rebirthBtn" class="rebirth-btn" onclick="performRebirth()">
                UPGRADE WORLD (REBIRTH)
            </button>
        </div>
        <div class="shop-panel">
            <div class="shop-header"><h3>EQUIPMENT</h3></div>
            <div class="shop-items" id="shopItems"></div>
        </div>
    </div>

<script>
    let upgrades = [
        { id: 'click', name: 'Wood Pickaxe', baseCost: 15, cost: 15, power: 1, owned: 0, type: 'click' },
        { id: 'auto1', name: 'Stone Golem', baseCost: 100, cost: 100, power: 4, owned: 0, type: 'auto' },
        { id: 'auto2', name: 'Iron Drill', baseCost: 1500, cost: 1500, power: 30, owned: 0, type: 'auto' },
        { id: 'auto3', name: 'Magic Crystal', baseCost: 20000, cost: 20000, power: 250, owned: 0, type: 'auto' }
    ];

    let game = {
        money: 0,
        rebirths: 0,
        multiplier: 1,
        rebirthTarget: 40000,
        maxRebirths: 5
    };

    const SAVE_ID = "LowPolyClicker_v1";

    function saveGame() {
        localStorage.setItem(SAVE_ID, JSON.stringify({ game, upgrades }));
    }

    function loadGame() {
        const saved = localStorage.getItem(SAVE_ID);
        if (saved) {
            const data = JSON.parse(saved);
            game = data.game;
            upgrades = data.upgrades;
            const totalAutos = upgrades.filter(u => u.type === 'auto').reduce((a, b) => a + b.owned, 0);
            for(let i=0; i < Math.min(totalAutos, 10); i++) spawnCoin();
        }
        updateUI();
    }function updateUI() {
        document.getElementById('money').innerText = "$" + Math.floor(game.money).toLocaleString();
        document.getElementById('multiplier-badge').innerText = `x${game.multiplier.toFixed(1)}`;
        document.getElementById('rebirth-count').innerText = `WORLD: ${game.rebirths}/${game.maxRebirths}`;
        
        const rBtn = document.getElementById('rebirthBtn');
        if (game.rebirths >= game.maxRebirths) {
            rBtn.style.display = "block";
            rBtn.style.background = "#2c3e50";
            rBtn.innerText = "⭐ MAX WORLD LEVEL";
            rBtn.onclick = null;
        } else if (game.money >= game.rebirthTarget) {
            rBtn.classList.add('available');
            rBtn.innerText = `REBIRTH TO WORLD ${game.rebirths + 2} (Bonus x${(game.multiplier + 1.5).toFixed(1)})`;
        } else {
            rBtn.classList.remove('available');
        }
        renderShop();
    }

    function renderShop() {
        const container = document.getElementById('shopItems');
        container.innerHTML = '';
        upgrades.forEach(u => {
            container.innerHTML += `
                <div class="item ${game.money < u.cost ? 'locked' : ''}" onclick="buyUpgrade('${u.id}')">
                    <div>
                        <b style="font-size:0.9rem">${u.name}</b><br>
                        <small>LVL ${u.owned} • $${u.cost.toLocaleString()}</small>
                    </div>
                    <div style="font-weight:bold">${u.type === 'click' ? '+'+u.power : '+'+u.power+'/s'}</div>
                </div>`;
        });
    }

    function buyUpgrade(id) {
        const u = upgrades.find(x => x.id === id);
        if (game.money >= u.cost) {
            game.money -= u.cost;
            u.owned++;
            u.cost = Math.floor(u.baseCost * Math.pow(1.3, u.owned));
            if (u.type === 'auto' && document.querySelectorAll('.coin').length < 12) spawnCoin();
            updateUI();
            saveGame();
        }
    }

    function performRebirth() {
        if (game.rebirths >= game.maxRebirths || game.money < game.rebirthTarget) return;

        if (confirm("¿Avanzar al siguiente mundo? Perderás tus mejoras pero ganarás un multiplicador x1.5 y $10.")) {
            game.rebirths++;
            game.multiplier += 1.5;
            game.money = 10; // Bono inicial solicitado
            game.rebirthTarget *= 7;
            
            upgrades.forEach(u => {
                u.owned = 0;
                u.cost = u.baseCost;
            });

            document.querySelectorAll('.coin').forEach(c => c.remove());
            spawnCoin();
            saveGame();
            updateUI();
        }
    }

    function spawnCoin() {
        const c = document.createElement('div');
        c.className = 'coin';
        // Color aleatorio estilo gema para cada moneda
        const colors = ['#f1c40f', '#e74c3c', '#3498db', '#9b59b6'];
        c.style.background = colors[Math.floor(Math.random()*colors.length)];
        c.style.left = Math.random() * 70 + 10 + "%";
        c.style.top = Math.random() * 70 + 10 + "%";
        
        c.onclick = (e) => {
            const clickPower = (1 + upgrades.filter(u => u.type === 'click').reduce((a, b) => a + (b.owned * b.power), 0));
            const totalGain = clickPower * game.multiplier;
            game.money += totalGain;
            
            // Texto de click estilo "Pop-up" cuadrado
            const t = document.createElement('div');
            t.innerText = `+${totalGain.toFixed(0)}`;
            t.style.cssText = `position:absolute; left:${e.pageX}px; top:${e.pageY}px; color:#fff; font-weight:bold; pointer-events:none; background:#2c3e50; padding:2px 5px;`;
            document.body.appendChild(t);
            t.animate([{transform:'scale(1)', opacity:1}, {transform:'scale(1.5) translateY(-50px)', opacity:0}], 600);
            setTimeout(() => t.remove(), 600);
            
            updateUI();
        };
        document.getElementById('gameArea').appendChild(c);
    }

    // Loop de ingresos automáticos
    setInterval(() => {
        const autoPower = upgrades.filter(u => u.type === 'auto').reduce((a, b) => a + (b.owned * b.power), 0);
        if (autoPower > 0) {
            game.money += (autoPower * game.multiplier) / 10;
            updateUI();
        }
    }, 100);

    window.onload = () => {
        loadGame();
        if (document.querySelectorAll('.coin').length === 0) spawnCoin();
    };
</script>
</body>
</html>
