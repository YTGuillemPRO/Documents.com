<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pets and money</title>
    <style>
        /* CONFIGURACI√ìN GLOBAL DEL DOCUMENTO */
        :root {
            --primary-color: #4caf50;
            --secondary-color: #2196f3;
            --danger-color: #f44336;
            --background-gradient: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            --frame-bg: rgba(255, 255, 255, 0.98);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: var(--background-gradient);
            overflow: hidden;
        }

        /* CONTENEDOR PRINCIPAL - FRAME DEL JUEGO */
        #game-container {
            width: 420px;
            height: 720px;
            background: var(--frame-bg);
            border-radius: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            padding: 25px;
            position: relative;
            border: 4px solid #ffffff;
        }

        header {
            text-align: center;
            margin-bottom: 15px;
        }

        header h1 {
            font-size: 26px;
            color: #2c3e50;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 5px;
        }

        /* SISTEMA DE NAVEGACI√ìN POR PESTA√ëAS */
        .navigation-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .nav-button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 15px;
            background: #ecf0f1;
            color: #7f8c8d;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .nav-button.active {
            background: var(--primary-color);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        /* PANEL DE ESTAD√çSTICAS */
        .stats-panel {
            background: #fdfdfd;
            border: 2px solid #f1f1f1;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }

        .stat-money {
            font-size: 32px;
            font-weight: 900;
            color: #27ae60;
            display: block;
            margin-bottom: 5px;
        }

        .stat-price {
            color: #95a5a6;
            font-size: 16px;
            font-weight: 600;
        }

        /* SELECTOR DE TIPO DE HUEVO */
        .egg-selector-container {
            display: flex;
            background: #eee;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .egg-option {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 13px;
            transition: 0.3s;
        }

        .egg-option.active {
            background: white;
            color: #333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* BOTONES DE ACCI√ìN PRINCIPALES */
        .main-action-btn {
            width: 100%;
            padding: 18px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            text-transform: uppercase;
        }

        #buyEggBtn {
            background: linear-gradient(to right, #f83600 0%, #f9d423 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(248, 54, 0, 0.3);
        }

        #buyEggBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(248, 54, 0, 0.4);
        }

        #rebirthBtn {
            background: #2980b9;
            color: white;
            font-size: 15px;
        }

        #rebirthBtn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* LISTADO DE MASCOTAS */
        .inventory-title {
            text-align: left;
            font-size: 14px;
            color: #34495e;
            font-weight: bold;
            margin-bottom: 10px;
            padding-left: 5px;
        }

        #pet-list-display {
            flex: 1;
            overflow-y: auto;
            padding-right: 8px;
            margin-top: 10px;
        }

        /* DISE√ëO DE CADA MASCOTA */
        .pet-item {
            background: #ffffff;
            border: 1px solid #eee;
            border-radius: 15px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .pet-info-wrapper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pet-icon-circle {
            width: 45px;
            height: 45px;
            background: #f9f9f9;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
        }

        /* COLORES POR RAREZA */
        .rarity-common { border-left: 6px solid #bdc3c7; }
        .rarity-uncommon { border-left: 6px solid #2ecc71; }
        .rarity-rare { border-left: 6px solid #3498db; }
        .rarity-god { border-left: 6px solid #9b59b6; }
        .rarity-secret { border-left: 6px solid #f1c40f; }
        .rarity-og { border-left: 6px solid #e91e63; }
     /* BOT√ìN VENDER */
        .sell-button {
            background: #ffebee;
            color: #c62828;
            border: none;
            border-radius: 8px;
            padding: 6px 12px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
        }

        .sell-button:hover {
            background: #c62828;
            color: white;
        }

        /* OVERLAY DE APERTURA (HATCHING) */
        #hatch-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            border-radius: 26px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            color: white;
            text-align: center;
        }

        .egg-animation {
            width: 150px;
            height: 200px;
            background: radial-gradient(circle at 30% 30%, #fff, #ffeb3b);
            border-radius: 50% 50% 45% 45%;
            border: 6px solid #fbc02d;
            margin-bottom: 30px;
            position: relative;
        }

        .shake { animation: eggShake 0.1s infinite; }

        @keyframes eggShake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(3deg); }
            75% { transform: rotate(-3deg); }
            100% { transform: rotate(0deg); }
        }

        /* PANTALLA DE INDEX */
        .index-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            padding-bottom: 20px;
        }

        .index-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 10px;
            font-size: 11px;
            opacity: 0.4;
            filter: grayscale(1);
        }

        .index-card.discovered {
            opacity: 1;
            filter: grayscale(0);
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>

    <div id="hatch-overlay">
        <div id="hatch-egg-visual" class="egg-animation"></div>
        <div id="hatch-result" style="display:none;">
            <div id="hatch-icon" style="font-size: 80px; margin-bottom: 10px;"></div>
            <h2 id="hatch-name" style="font-size: 28px; text-transform: uppercase;"></h2>
            <p id="hatch-rarity" style="font-weight: bold; letter-spacing: 2px; margin-bottom: 20px;"></p>
            <button onclick="closeHatch()" class="main-action-btn" style="background: white; color: black; width: 200px;">COLECCIONAR</button>
        </div>
    </div>

    <div id="game-container">
        <header>
            <h1>Pets and Money</h1>
            <p id="rebirth-counter" style="color: #7f8c8d; font-weight: bold; font-size: 12px;">REBIRTH: 0</p>
        </header>

        <div class="navigation-bar">
            <button id="btn-tab-game" class="nav-button active" onclick="switchTab('game')">JUGAR</button>
            <button id="btn-tab-index" class="nav-button" onclick="switchTab('index')">COLECCI√ìN</button>
        </div>

        <div id="tab-game">
            <div class="stats-panel">
                <span class="stat-money">üí∞ $<span id="display-money">10</span></span>
                <span class="stat-price">COSTO HUEVO: $<span id="display-price">10</span></span>
            </div>

            <div class="egg-selector-container">
                <div id="opt-normal" class="egg-option active" onclick="setEggType('normal')">HUEVO B√ÅSICO</div>
                <div id="opt-special" class="egg-option" onclick="setEggType('special')">HUEVO √âPICO</div>
            </div>

            <button id="buyEggBtn" class="main-action-btn" onclick="attemptPurchase()">ABRIR HUEVO</button>
            <button id="rebirthBtn" class="main-action-btn" onclick="executeRebirth()" disabled>REALIZAR REBIRTH</button>

            <p class="inventory-title">MIS MASCOTAS:</p>
            <div id="pet-list-display"></div>
        </div>

        <div id="tab-index" style="display:none;">
            <div id="index-list-display" class="index-grid"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDpmb0duQ3ZgjbipPWsMvpLx3d-vojQAxM",
            authDomain: "inici-de-sessio.firebaseapp.com",
            projectId: "inici-de-sessio",
            storageBucket: "inici-de-sessio.firebasestorage.app",
            messagingSenderId: "106046428749",
            appId: "1:106046428749:web:c555c61ff94f5f5691ee04",
            databaseURL: "https://inici-de-sessio-default-rtdb.europe-west1.firebasedatabase.app"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const userId = "partida_pro_2026"; 
        const userPath = 'users/' + userId;

        // --- DATA POOLS: LISTADO EXTENSO DE MASCOTAS ---
        const NORMAL_POOL = [
            { id: 101, n: 'Rat√≥n de Campo', i: 'üê≠', r: 'common', e: 5 },
            { id: 102, n: 'Perro Fiel', i: 'üê∂', r: 'common', e: 8 },
            { id: 103, n: 'Gato Callejero', i: 'üê±', r: 'common', e: 12 },
            { id: 104, n: 'Conejo Saltador', i: 'üê∞', r: 'uncommon', e: 25 },
            { id: 105, n: 'Zorro Astuto', i: 'ü¶ä', r: 'uncommon', e: 45 },
            { id: 106, n: 'Panda Dormil√≥n', i: 'üêº', r: 'rare', e: 110 },
            { id: 107, n: 'Le√≥n Valiente', i: 'ü¶Å', r: 'rare', e: 180 },
            { id: 108, n: 'Drag√≥n Beb√©', i: 'üê≤', r: 'god', e: 450 },
            { id: 109, n: 'Unicornio M√°gico', i: 'ü¶Ñ', r: 'secret', e: 1200 }
        ];

        const SPECIAL_POOL = [
            { id: 201, n: 'Rat√≥n Dorado', i: 'üê≠', r: 'uncommon', e: 80 },
            { id: 202, n: 'Perro Cyborg', i: 'üê∂', r: 'rare', e: 210 },
            { id: 203, n: 'Lobo Alfa', i: 'üê∫', r: 'rare', e: 350 },
            { id: 204, n: 'Tigre de Bengala', i: 'üêØ', r: 'god', e: 750 },
            { id: 205, n: 'F√©nix Ardiente', i: 'üî•', r: 'god', e: 1100 },
            { id: 206, n: 'Drag√≥n Infernal', i: 'üêâ', r: 'secret', e: 3500 },
            { id: 207, n: 'Kraken Junior', i: 'üêô', r: 'secret', e: 5500 },
            { id: 208, n: 'T-Rex Antiguo', i: 'ü¶ñ', r: 'og', e: 12000 }
        ];
     // --- VARIABLES DE ESTADO DEL SISTEMA ---
        let money = 0;
        let eggPrice = 10;
        let specialEggPrice = 1000;
        let rebirths = 0;
        let multiplier = 1;
        let activeEgg = 'normal';
        let inventory = [];
        let discoveredIds = [];

        // --- MOTOR DE PERSISTENCIA (FIREBASE) ---
        async function saveProgress() {
            try {
                await set(ref(db, userPath), {
                    money: money,
                    eggPrice: eggPrice,
                    specialEggPrice: specialEggPrice,
                    rebirths: rebirths,
                    multiplier: multiplier,
                    inventory: inventory,
                    discoveredIds: discoveredIds,
                    lastUpdate: Date.now()
                });
                console.log(">> Datos sincronizados con Firebase");
            } catch (e) {
                console.error(">> Error en la nube:", e);
            }
        }

async function loadProgress() {
            const snapshot = await get(ref(db, userPath));
            if (snapshot.exists()) {
                const data = snapshot.val();
                // Si el dinero en la nube es 0, pero es un jugador viejo, se queda en 0
                money = data.money !== undefined ? data.money : 10; 
                eggPrice = data.eggPrice || 10;
                specialEggPrice = data.specialEggPrice || 1000;
                rebirths = data.rebirths || 0;
                multiplier = data.multiplier || 1;
                inventory = data.inventory || [];
                discoveredIds = data.discoveredIds || [];
                updateUI();
            } else {
                // SI ES UN JUGADOR TOTALMENTE NUEVO (No existe en Firebase)
                money = 10; // <--- LE DAMOS SUS PRIMEROS 10 D√ìLARES
                updateUI();
                saveProgress(); // Creamos su entrada en la nube
                console.log(">> Nuevo jugador detectado: Regalo inicial de $10 entregado.");
            }
        }
        // --- L√ìGICA DE INTERFAZ (UI) ---
        window.updateUI = function() {
            document.getElementById('display-money').textContent = Math.floor(money).toLocaleString();
            document.getElementById('display-price').textContent = (activeEgg === 'normal' ? eggPrice : specialEggPrice).toLocaleString();
            document.getElementById('rebirth-counter').textContent = `REBIRTH: ${rebirths} (x${multiplier} Mult)`;
            
            const list = document.getElementById('pet-list-display');
            list.innerHTML = '';

            inventory.forEach((pet, index) => {
                const item = document.createElement('div');
                item.className = `pet-item rarity-${pet.r}`;
                item.innerHTML = `
                    <div class="pet-info-wrapper">
                        <div class="pet-icon-circle">${pet.i}</div>
                        <div>
                            <div style="font-weight:bold">${pet.n}</div>
                            <div style="font-size:10px; color:#666">+$${pet.e}/s</div>
                        </div>
                    </div>
                    <button class="sell-button" onclick="sellPet(${index})">VENDER</button>
                `;
                list.appendChild(item);
            });

            const rbBtn = document.getElementById('rebirthBtn');
            const rbCost = (rebirths + 1) * 1000000;
            rbBtn.disabled = money < rbCost;
            if (!rbBtn.disabled) rbBtn.style.background = "#e67e22";
        };

        // --- SISTEMA DE COMPRA Y APERTURA ---
        window.setEggType = function(type) {
            activeEgg = type;
            document.getElementById('opt-normal').classList.toggle('active', type === 'normal');
            document.getElementById('opt-special').classList.toggle('active', type === 'special');
            updateUI();
        };

        window.attemptPurchase = function() {
            const cost = (activeEgg === 'normal' ? eggPrice : specialEggPrice);
            if (money < cost) return alert("¬°No tienes suficiente dinero!");

            money -= cost;
            if (activeEgg === 'normal') eggPrice = Math.floor(eggPrice * 1.2);
            else specialEggPrice = Math.floor(specialEggPrice * 1.3);

            startHatchAnimation();
        };

        function startHatchAnimation() {
            const overlay = document.getElementById('hatch-overlay');
            const visual = document.getElementById('hatch-egg-visual');
            const result = document.getElementById('hatch-result');
            
            overlay.style.display = 'flex';
            visual.style.display = 'block';
            result.style.display = 'none';
            visual.classList.add('shake');

            setTimeout(() => {
                visual.classList.remove('shake');
                visual.style.display = 'none';
                
                const pool = (activeEgg === 'normal' ? NORMAL_POOL : SPECIAL_POOL);
                const rolled = pool[Math.floor(Math.random() * pool.length)];
                
                inventory.push(rolled);
                if (!discoveredIds.includes(rolled.id)) discoveredIds.push(rolled.id);

                document.getElementById('hatch-icon').textContent = rolled.i;
                document.getElementById('hatch-name').textContent = rolled.n;
                document.getElementById('hatch-rarity').textContent = rolled.r.toUpperCase();
                document.getElementById('hatch-rarity').style.color = getRarityColor(rolled.r);
                
                result.style.display = 'block';
                updateUI();
                saveProgress();
            }, 1500);
        }

        window.closeHatch = function() {
            document.getElementById('hatch-overlay').style.display = 'none';
        };

        function getRarityColor(r) {
            const colors = { common: '#bdc3c7', uncommon: '#2ecc71', rare: '#3498db', god: '#9b59b6', secret: '#f1c40f', og: '#e91e63' };
            return colors[r] || '#000';
        }

        // --- ACCIONES SECUNDARIAS ---
        window.sellPet = function(index) {
            const pet = inventory[index];
            money += (pet.e * 60); // Te da 1 minuto de ganancias producidas
            inventory.splice(index, 1);
            updateUI();
            saveProgress();
        };

        window.executeRebirth = function() {
            const rbCost = (rebirths + 1) * 1000000;
            if (money < rbCost) return;

            rebirths++;
            multiplier *= 2;
            money = 0;
            inventory = [];
            eggPrice = 10;
            specialEggPrice = 1000;
            
            updateUI();
            saveProgress();
            alert("¬°REBIRTH COMPLETADO! Tu producci√≥n se ha duplicado.");
        };

        window.switchTab = function(tab) {
            document.getElementById('tab-game').style.display = (tab === 'game' ? 'block' : 'none');
            document.getElementById('tab-index').style.display = (tab === 'index' ? 'block' : 'none');
            document.getElementById('btn-tab-game').classList.toggle('active', tab === 'game');
            document.getElementById('btn-tab-index').classList.toggle('active', tab === 'index');
            if (tab === 'index') renderIndex();
        };

        function renderIndex() {
            const container = document.getElementById('index-list-display');
            container.innerHTML = '';
            const fullPool = [...NORMAL_POOL, ...SPECIAL_POOL];
            
            fullPool.forEach(p => {
                const isFound = discoveredIds.includes(p.id);
                const card = document.createElement('div');
                card.className = `index-card ${isFound ? 'discovered' : ''}`;
                card.innerHTML = `
                    <div style="font-size:20px">${isFound ? p.i : '‚ùì'}</div>
                    <div style="font-weight:bold">${isFound ? p.n : '???'}</div>
                    <div>${isFound ? p.r : 'Desconocido'}</div>
                `;
                container.appendChild(card);
            });
        }

        // --- LOOP PRINCIPAL (DINERO PASIVO) ---
        setInterval(() => {
            let totalPerSec = 0;
            inventory.forEach(pet => { totalPerSec += pet.e; });
            
            if (totalPerSec > 0) {
                money += (totalPerSec * multiplier);
                document.getElementById('display-money').textContent = Math.floor(money).toLocaleString();
                // Verificamos si ya puede pagar el rebirth sin redibujar toda la lista
                const rbCost = (rebirths + 1) * 1000000;
                if (money >= rbCost) document.getElementById('rebirthBtn').disabled = false;
            }
        }, 1000);

        // Guardado autom√°tico cada 30 segundos por seguridad
        setInterval(saveProgress, 30000);

        // INICIO
        loadProgress();

    </script>
</body>
</html>
