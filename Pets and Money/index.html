<script>
  // CONFIGURACI√ìN DE DATOS
  const petsConfig = {
    normal: [
      {icon:'üê≠', name:'Rat√≥n de Campo', rarity:'common', earnings:5},
      {icon:'üê∂', name:'Perro Fiel', rarity:'common', earnings:12},
      {icon:'üê±', name:'Gato Curioso', rarity:'common', earnings:15},
      {icon:'üê∞', name:'Conejo', rarity:'common', earnings:20},
      {icon:'üê•', name:'Pollito', rarity:'common', earnings:25},
      {icon:'ü¶ä', name:'Zorro', rarity:'rare', earnings:80},
      {icon:'üêª', name:'Oso', rarity:'rare', earnings:110},
      {icon:'üêº', name:'Panda', rarity:'rare', earnings:150},
      {icon:'üê®', name:'Koala', rarity:'rare', earnings:200},
      {icon:'üêØ', name:'Tigre', rarity:'epic', earnings:450},
      {icon:'ü¶Å', name:'Le√≥n', rarity:'epic', earnings:600},
      {icon:'üê∫', name:'Lobo', rarity:'epic', earnings:800}
    ],
    special: [
      {icon:'ü¶Å', name:'Le√≥n Majestuoso', rarity:'rare', earnings:200},
      {icon:'ü¶Ñ', name:'Unicornio M√≠stico', rarity:'god', earnings:650},
      {icon:'üê≤', name:'Drag√≥n Ancestral', rarity:'god', earnings:1500},
      {icon:'ü¶ñ', name:'T-Rex OG', rarity:'og', earnings:6000},
      {icon:'ü¶Ñ', name:'Unicornio', rarity:'legendary', earnings:2500},
      {icon:'üê≤', name:'Drag√≥n', rarity:'legendary', earnings:3500},
      {icon:'üî±', name:'Poseid√≥n', rarity:'mythic', earnings:8000},
      {icon:'üî•', name:'F√©nix', rarity:'mythic', earnings:12000},
      {icon:'‚ö°', name:'Zeus', rarity:'mythic', earnings:18000},
      {icon:'üëæ', name:'Glitch', rarity:'secret', earnings:50000},
      {icon:'üåå', name:'Galaxia', rarity:'secret', earnings:100000},
      {icon:'üíé', name:'Diamante', rarity:'secret', earnings:250000},
      {icon:'üëÅÔ∏è', name:'Illuminati', rarity:'secret', earnings:500000},
      {icon:'üëë', name:'EL REY OG', rarity:'og', earnings:2000000}
    ]
  };

  const rebirthCosts = [1000000, 15000000, 100000000, 750000000, 3000000000];
  
  // ESTADO GLOBAL CON GUARDADO
  let state = {
    money: 10,
    rb: 0,
    mult: 1,
    pets: [],
    discovered: [],
    priceN: 10,
    priceS: 500
  };

  let isSpecial = false;

  // FUNCIONES DE PERSISTENCIA
  function save() { 
    localStorage.setItem('PetSimPro_GlobalSave', JSON.stringify(state)); 
  }

  function load() {
    const data = localStorage.getItem('PetSimPro_GlobalSave');
    if (data) state = JSON.parse(data);
    updateUI();
  }

  function updateUI() {
    document.getElementById('money').innerText = Math.floor(state.money).toLocaleString();
    document.getElementById('rbLevel').innerText = state.rb;
    document.getElementById('rbMult').innerText = state.mult;
    document.getElementById('priceN').innerText = state.priceN.toLocaleString();
    document.getElementById('priceS').innerText = state.priceS.toLocaleString();
    
    const rbBtn = document.getElementById('rebirthBtn');
    if (state.rb >= 5) {
      rbBtn.innerText = "‚≠ê M√ÅXIMO NIVEL ALCANZADO";
      rbBtn.disabled = true;
    } else {
      let cost = rebirthCosts[state.rb];
      rbBtn.innerText = `‚ö° REBIRTH ${state.rb+1} ($${cost.toLocaleString()})`;
      rbBtn.disabled = state.money < cost;
    }
    renderPets();
  }

  function setEgg(s) { 
    isSpecial = s; 
    document.getElementById('normalBtn').classList.toggle('active', !s); 
    document.getElementById('specialBtn').classList.toggle('active', s); 
  }

  function openEgg() {
    let cost = isSpecial ? state.priceS : state.priceN;
    if (state.money < cost) return;
    state.money -= cost;
    
    if (isSpecial) state.priceS = Math.floor(state.priceS * 1.35);
    else state.priceN = Math.floor(state.priceN * 1.28);

    const pool = isSpecial ? petsConfig.special : petsConfig.normal;
    const pet = pool[Math.floor(Math.random() * pool.length)];
    state.pets.push({...pet, id: Date.now()});
    
    if (!state.discovered.includes(pet.name)) state.discovered.push(pet.name);

    playHatchAnimation(pet);
    save();
    updateUI();
  }

  function playHatchAnimation(pet) {
    const overlay = document.getElementById('hatchOverlay');
    const egg = document.getElementById('hatchEgg');
    const icon = document.getElementById('hatchedPetIcon');
    
    overlay.style.display = 'flex';
    egg.style.display = 'block';
    icon.style.display = 'none';
    egg.className = 'shaking';

    setTimeout(() => {
      egg.className = 'breaking';
      setTimeout(() => {
        egg.style.display = 'none';
        icon.style.display = 'block';
        icon.innerText = pet.icon;
        document.getElementById('hatchedPetName').innerText = pet.name;
        document.getElementById('hatchedPetInfo').innerText = `${pet.rarity.toUpperCase()} | +$${(pet.earnings * state.mult).toFixed(1)}/seg`;
      }, 500);
    }, 1200);
  }

  function renderPets() {
    const list = document.getElementById('petList');
    list.innerHTML = '';
    state.pets.forEach(p => {
      const div = document.createElement('div');
      div.className = `pet ${p.rarity}`;
      div.innerHTML = `
        <span>${p.icon} ${p.name}</span>
        <span>$${(p.earnings * state.mult).toFixed(1)}/s 
          <button class="sellBtn" onclick="sell(${p.id})">Vender</button>
        </span>
      `;
      list.appendChild(div);
    });
  }

  function sell(id) {
    let idx = state.pets.findIndex(p => p.id === id);
    if (idx === -1) return;
    state.money += state.pets[idx].earnings * 15;
    state.pets.splice(idx, 1);
    save(); 
    updateUI();
  }

  function doRebirth() {
    if (state.rb >= 5 || state.money < rebirthCosts[state.rb]) return;
    state.rb++;
    state.mult *= 4; // Multiplicador x4 por Rebirth
    state.money = 10; // SIEMPRE EMPIEZA CON $10
    state.pets = [];
    state.priceN = 10;
    state.priceS = 500;
    save(); 
    updateUI();
    alert("¬°REBIRTH COMPLETADO! Ganancias x4 y has vuelto a empezar con $10.");
  }

  function switchTab(t) {
    document.getElementById('tabPets').style.display = t === 'pets' ? 'flex' : 'none';
    document.getElementById('tabIndex').style.display = t === 'index' ? 'block' : 'none';
    document.getElementById('tabPetsBtn').classList.toggle('active', t === 'pets');
    document.getElementById('tabIndexBtn').classList.toggle('active', t === 'index');
    if (t === 'index') renderIndex();
  }

  function renderIndex() {
    const idxL = document.getElementById('indexList');
    idxL.innerHTML = '';
    [...petsConfig.normal, ...petsConfig.special].forEach(p => {
      const disc = state.discovered.includes(p.name);
      const row = document.createElement('div');
      row.className = 'pet';
      row.style.opacity = disc ? '1' : '0.25';
      row.innerHTML = `<span>${disc ? p.icon : '‚ùì'} ${p.name}</span> <span>${p.rarity.toUpperCase()}</span>`;
      idxL.appendChild(row);
    });
  }

  // Cerrar overlay del hatch
  document.getElementById('closeHatchBtn').onclick = () => {
    const overlay = document.getElementById('hatchOverlay');
    const egg = document.getElementById('hatchEgg');
    const icon = document.getElementById('hatchedPetIcon');
    overlay.style.display = 'none';
    egg.className = '';
    egg.style.display = 'block';
    icon.style.display = 'none';
  };

  // BUCLE DE INGRESOS SEGUNDO A SEGUNDO
  setInterval(() => {
    let totalIncome = state.pets.reduce((acc, p) => acc + p.earnings, 0) * state.mult;
    if (totalIncome > 0) {
      state.money += totalIncome;
      updateUI();
    }
  }, 1000);

  // Carga inicial
  window.onload = load;
</script>
