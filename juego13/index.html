<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Stickman Plataforma</title>
<style>
    body {
        margin: 0;
        background: #1e1e1e;
        color: white;
        text-align: center;
        font-family: Arial;
    }
    canvas {
        display: block;
        margin: auto;
        background: #2b2b2b;
    }
</style>
</head>
<body>

<h3>Stickman con Arco (Plataforma)</h3>
<canvas id="game" width="900" height="450"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// PLATAFORMA PRINCIPAL
const platform = {
    x: 120,
    y: 320,
    width: 200,
    height: 20
};

// JUGADOR
const player = {
    x: platform.x + platform.width / 2,
    y: platform.y,
    vy: 0,
    jumping: false,
    life: 100,
    stamina: 100
};

const gravity = 0.9;
let arrows = [];
let enemies = [];
let apples = [];

// CONTROLES
document.addEventListener("keydown", e => {
    if (e.code === "Space" && !player.jumping && player.stamina > 15) {
        player.vy = -16;
        player.jumping = true;
        player.stamina -= 15;
    }
});

canvas.addEventListener("click", () => {
    arrows.push({
        x: player.x + 15,
        y: player.y - 35,
        vx: 10
    });
});

// ENEMIGOS EN PLATAFORMAS
function spawnEnemy() {
    enemies.push({
        x: 600,
        y: 260,
        life: 40
    });
}

function spawnApple() {
    apples.push({
        x: 450,
        y: 300
    });
}

setInterval(spawnEnemy, 2500);
setInterval(spawnApple, 6000);

// LOOP
function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // FONDO ESTRELLAS
    ctx.fillStyle = "white";
    for (let i = 0; i < 30; i++) {
        ctx.fillRect(Math.random() * 900, Math.random() * 450, 2, 2);
    }

    // PLATAFORMA
    ctx.fillStyle = "#555";
    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);

    // FÃSICAS JUGADOR
    player.y += player.vy;
    player.vy += gravity;

    if (player.y >= platform.y) {
        player.y = platform.y;
        player.vy = 0;
        player.jumping = false;
    }

    if (player.stamina < 100) player.stamina += 0.2;

    // STICKMAN
    ctx.strokeStyle = "white";
    ctx.lineWidth = 3;
    ctx.beginPath();
    ctx.arc(player.x, player.y - 45, 10, 0, Math.PI * 2);
    ctx.moveTo(player.x, player.y - 35);
    ctx.lineTo(player.x, player.y - 5);
    ctx.lineTo(player.x - 10, player.y + 15);
    ctx.moveTo(player.x, player.y - 5);
    ctx.lineTo(player.x + 10, player.y + 15);
    ctx.stroke();

    // ARCO
    ctx.strokeStyle = "orange";
    ctx.beginPath();
    ctx.arc(player.x + 12, player.y - 30, 18, -1, 1);
    ctx.stroke();

    // FLECHAS
    arrows.forEach((a, i) => {
        a.x += a.vx;
        ctx.strokeStyle = "white";
        ctx.beginPath();
        ctx.moveTo(a.x, a.y);
        ctx.lineTo(a.x - 15, a.y);
        ctx.stroke();

        enemies.forEach((e, ei) => {
            if (a.x > e.x && a.x < e.x + 25 && a.y > e.y - 40 && a.y < e.y) {
                e.life -= 20;
                arrows.splice(i, 1);
                if (e.life <= 0) enemies.splice(ei, 1);
            }
        });
    });

    // ENEMIGOS
    enemies.forEach(e => {
        ctx.fillStyle = "#777";
        ctx.fillRect(e.x - 20, e.y, 60, 15);
        ctx.fillStyle = "white";
        ctx.fillRect(e.x, e.y - 40, 25, 40);
    });

    // MANZANAS
    apples.forEach((a, i) => {
        ctx.fillStyle = "green";
        ctx.beginPath();
        ctx.arc(a.x, a.y, 8, 0, Math.PI * 2);
        ctx.fill();

        if (Math.abs(a.x - player.x) < 15 && Math.abs(a.y - player.y) < 20) {
            player.life = Math.min(100, player.life + 20);
            apples.splice(i, 1);
        }
    });

    // HUD
    ctx.fillStyle = "red";
    ctx.fillRect(20, 20, player.life * 2, 10);
    ctx.fillStyle = "cyan";
    ctx.fillRect(20, 40, player.stamina * 2, 10);

    if (player.life > 0) {
        requestAnimationFrame(update);
    } else {
        ctx.fillStyle = "white";
        ctx.fillText("GAME OVER", 420, 220);
    }
}

update();
</script>

</body>
</html>
