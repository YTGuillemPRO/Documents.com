<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Huevos, Pets y Rebirth Mejorados + Index</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { 
    font-family: Arial, sans-serif; 
    height: 100vh; 
    overflow: hidden; 
    background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
    display: flex; 
    justify-content: center; 
    align-items: center; 
  }
  #game { 
    width: 390px; 
    background: rgba(255,255,255,0.95); 
    border-radius: 20px; 
    padding: 18px; 
    text-align: center; 
    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    position: relative;
    z-index: 1;
  }
  h1 { font-size: 22px; margin-bottom: 8px; color: #333; }
  .top-buttons {
    display: flex;
    gap: 8px;
    margin-bottom: 6px;
  }
  .tab-btn {
    flex: 1;
    padding: 6px;
    font-size: 12px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: #e0e0e0;
    font-weight: bold;
  }
  .tab-btn.active {
    background: #4caf50;
    color: #fff;
  }
  .stats { background: #f8f9fa; padding: 10px; border-radius: 15px; margin: 6px 0; }
  .money { font-size: 22px; font-weight: bold; color: #4CAF50; }
  .egg-price { font-size: 15px; color: #666; margin: 4px 0 6px; }
  .egg-selector {
    display: flex;
    justify-content: center;
    gap: 6px;
    margin-bottom: 6px;
  }
  .egg-type-btn {
    flex: 1;
    padding: 6px 6px;
    font-weight: bold;
    border-radius: 10px;
    border: 2px solid transparent;
    cursor: pointer;
    background-color: #ddd;
    user-select: none;
    transition: 0.3s;
    font-size: 11px;
  }
  .egg-type-btn.active {
    background-color: #4caf50;
    color: white;
    border-color: #4caf50;
  }
  button { 
    width: 100%; 
    padding: 12px; 
    font-size: 15px; 
    border: none; 
    border-radius: 12px; 
    cursor: pointer; 
    margin: 5px 0; 
    transition: all 0.3s; 
  }
  #buyEggBtn { 
    background: linear-gradient(45deg, #ff6b6b, #feca57); 
    color: white; 
    font-weight: bold;
  }
  #buyEggBtn:hover { transform: scale(1.03); }
  #rebirthBtn {
    background: #2196F3;
    color: white;
    font-weight: bold;
    font-size: 13px;
  }
  #rebirthBtn:disabled {
    background: #90caf9;
    cursor: not-allowed;
  }
  #rebirthInfo {
    font-size: 11px;
    color: #555;
    margin-top: 2px;
  }
  #openResult { 
    min-height: 32px; 
    font-size: 13px; 
    font-weight: bold; 
    margin: 6px 0; 
    padding: 6px; 
    border-radius: 10px; 
    background: #e3f2fd; 
    border: 2px solid #2196F3;
  }

  /* Pesta√±as */
  .tab-content { display: none; }
  .tab-content.active { display: block; }

  #petList { 
    max-height: 210px; 
    overflow-y: auto; 
    margin-top: 6px; 
    text-align: left;
  }
  .pet { 
    margin: 4px 0; 
    padding: 7px; 
    border-radius: 10px; 
    font-weight: bold;
    background: #f0f0f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 12px;
  }
  .common { background: #e0e0e0; color: #555; }
  .uncommon { background: #c8e6c9; color: #2e7d32; }
  .rare { background: #bbdefb; color: #1565c0; }
  .god { background: #f3e5f5; color: #7b1fa2; }
  .secret { background: #fff3e0; color: #ef6c00; }
  .og { background: #ffe0f0; color: #c2185b; }

  .sellBtn {
    background: #ef5350;
    color: white;
    border: none;
    border-radius: 8px;
    padding: 3px 6px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px;
    transition: background 0.3s;
  }
  .sellBtn:hover {
    background: #d32f2f;
  }

  /* INDEX */
  #indexList {
    max-height: 230px;
    overflow-y: auto;
    text-align: left;
    margin-top: 8px;
    font-size: 12px;
  }
  .index-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 6px;
    border-radius: 8px;
    margin-bottom: 3px;
    background: #f5f5f5;
  }
  .index-row.owned {
    background: #dcedc8;
  }
  .index-name {
    font-weight: bold;
  }
  .index-meta {
    font-size: 11px;
    color: #555;
  }

  /* Overlay apertura tipo Pet Simulator */
  #hatchOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 5;
  }
  #hatchBox {
    background: #ffffff;
    border-radius: 20px;
    padding: 18px;
    width: 260px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0,0,0,0.6);
    position: relative;
  }
  #hatchEgg {
    width: 110px;
    height: 145px;
    margin: 0 auto 8px;
    background: radial-gradient(circle at 30% 30%, #fff, #ffd54f);
    border-radius: 50% 50% 45% 45%;
    border: 4px solid #ffb300;
    position: relative;
    animation: eggIdle 1.2s infinite ease-in-out;
  }
  #hatchEgg::before {
    content: "";
    position: absolute;
    inset: 15% 10% 40% 10%;
    background: radial-gradient(circle, rgba(255,255,255,0.9), transparent);
    border-radius: 50%;
    opacity: 0.7;
  }
  #hatchedPetIcon {
    font-size: 42px;
    display: none;
    animation: petPop 0.5s ease-out forwards;
  }
  #hatchedPetName {
    font-weight: bold;
    margin-top: 6px;
    font-size: 15px;
  }
  #hatchedPetInfo {
    font-size: 12px;
    margin-top: 2px;
    color: #555;
  }
  #closeHatchBtn {
    margin-top: 10px;
    padding: 7px 14px;
    font-size: 13px;
    border-radius: 10px;
    border: none;
    background: #4caf50;
    color: #fff;
    cursor: pointer;
  }

  @keyframes eggIdle {
    0%,100% { transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-4px) rotate(-3deg); }
    50% { transform: translateY(0) rotate(3deg); }
    75% { transform: translateY(-3px) rotate(-2deg); }
  }
  @keyframes eggShake {
    0% { transform: translateX(0) rotate(0deg); }
    20% { transform: translateX(-8px) rotate(-6deg); }
    40% { transform: translateX(8px) rotate(6deg); }
    60% { transform: translateX(-5px) rotate(-3deg); }
    80% { transform: translateX(5px) rotate(3deg); }
    100% { transform: translateX(0) rotate(0deg); }
  }
  @keyframes eggBreak {
    0% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(1.25); }
  }
  @keyframes petPop {
    0% { transform: scale(0.3); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
</style>
</head>
<body>
  <!-- Overlay animaci√≥n apertura -->
  <div id="hatchOverlay">
    <div id="hatchBox">
      <div id="hatchEgg"></div>
      <div id="hatchedPetIcon"></div>
      <div id="hatchedPetName"></div>
      <div id="hatchedPetInfo"></div>
      <button id="closeHatchBtn">Cerrar</button>
    </div>
  </div>

  <div id="game">
    <h1>ü•ö HUEVOS & PETS üêæ</h1>

    <div class="top-buttons">
      <button id="tabPetsBtn" class="tab-btn active">Juego</button>
      <button id="tabIndexBtn" class="tab-btn">Index</button>
    </div>

    <div class="stats">
      <div class="money">üí∞ $<span id="money">10</span></div>
      <div class="egg-price">ü•ö Precio: $<span id="eggPrice">10</span></div>
      <div class="egg-selector">
        <div id="normalEgg" class="egg-type-btn active">Normal</div>
        <div id="specialEgg" class="egg-type-btn">Especial</div>
      </div>
      <div id="rebirthInfo">Rebirth 1: 1M ‚Ä¢ Rebirth 2: 5M ‚Ä¢ Rebirth 3: 15M</div>
    </div>

    <!-- TAB JUEGO -->
    <div id="tabPets" class="tab-content active">
      <button id="buyEggBtn">üõí ABRIR HUEVO</button>
      <button id="rebirthBtn" disabled>‚ö° REBIRTH</button>
      <div id="openResult"></div>
      <div id="petList">
        <div style="color:#999; font-style:italic;">¬°Abre tu primer huevo!</div>
      </div>
    </div>

    <!-- TAB INDEX -->
    <div id="tabIndex" class="tab-content">
      <div style="font-size:12px; margin-top:4px; margin-bottom:4px;">
        üìñ Index de todos los pets (verde = ya lo tienes)
      </div>
      <div id="indexList"></div>
    </div>
  </div>

<script>
  // MISMO pool que antes + T-REX OG
  const normalPets = [
    {index: 0,  icon:'üê≠', name: 'Rat√≥n',       rarity: 'common',   earnings: 5},
    {index: 1,  icon:'üê∂', name: 'Perro',       rarity: 'common',   earnings: 8},
    {index: 2,  icon:'üê∞', name: 'Conejo',      rarity: 'common',   earnings: 10},
    {index: 3,  icon:'üê±', name: 'Gato',        rarity: 'uncommon', earnings: 18},
    {index: 4,  icon:'ü¶ä', name: 'Zorro',       rarity: 'uncommon', earnings: 25},
    {index: 5,  icon:'üêº', name: 'Panda',       rarity: 'uncommon', earnings: 35},
    {index: 6,  icon:'ü¶Å', name: 'Le√≥n',        rarity: 'rare',     earnings: 80},
    {index: 7,  icon:'ü¶Ö', name: '√Åguila',      rarity: 'rare',     earnings: 120},
    {index: 8,  icon:'üê≤', name: 'Drag√≥n',      rarity: 'god',      earnings: 250},
    {index: 9,  icon:'üïäÔ∏è', name: 'F√©nix',      rarity: 'god',      earnings: 350},
    {index:10,  icon:'ü¶Ñ', name: 'Unicornio',   rarity: 'secret',   earnings: 800}
  ];

  const specialPets = [
    {index: 0,  icon:'üê≠', name: 'Rat√≥n Dorado',     rarity: 'common',   earnings: 40},
    {index: 1,  icon:'üê∂', name: 'Perro Pro',        rarity: 'common',   earnings: 55},
    {index: 2,  icon:'üê±', name: 'Gato Gamer',       rarity: 'common',   earnings: 70},
    {index: 3,  icon:'ü¶ä', name: 'Zorro √âpico',      rarity: 'uncommon', earnings: 120},
    {index: 4,  icon:'üê∫', name: 'Lobo Alfa',        rarity: 'uncommon', earnings: 150},
    {index: 5,  icon:'üêØ', name: 'Tigre',            rarity: 'uncommon', earnings: 180},
    {index: 6,  icon:'ü¶Å', name: 'Le√≥n Dorado',      rarity: 'rare',     earnings: 300},
    {index: 7,  icon:'üêâ', name: 'Drag√≥n √âlite',     rarity: 'rare',     earnings: 420},
    {index: 8,  icon:'ü¶Ö', name: 'F√©nix Real',       rarity: 'god',      earnings: 700},
    {index: 9,  icon:'üê≤', name: 'Drag√≥n Ancestral', rarity: 'god',      earnings: 900},
    {index:10, icon:'ü¶£', name: 'Mamut OG',         rarity: 'secret',   earnings: 2000},
    {index:11, icon:'üê∏', name: 'Coquis',           rarity: 'secret',   earnings: 1500},
    {index:12, icon:'ü¶ñ', name: 'T‚ÄëRex OG',         rarity: 'og',       earnings: 3000}
  ];

  const normalRarityChances  = {common: 55, uncommon: 25, rare: 12, god: 6,  secret: 2,  og: 0};
  const specialRarityChances = {common: 35, uncommon: 30, rare: 18, god: 10, secret: 6,  og: 1};

  // Rebirths encadenados
  const rebirthThresholds = [1000000, 5000000, 15000000]; // 1M, 5M, 15M
  let rebirthLevel = 0; // 0 = sin rebirth, 1,2,3
  let money = 10;
  let normalEggPrice = 10;
  let specialEggPrice = 500;
  let ownedPets = [];
  let usingSpecialEgg = false;
  let moneyMultiplier = 1;

  function getRarityChances() {
    const base = usingSpecialEgg ? {...specialRarityChances} : {...normalRarityChances};
    // con cada rebirth se baja common y se suben raros
    if (rebirthLevel >= 1) {
      base.common  = Math.max(0, base.common  - 5);
      base.rare    += 2;
      base.god     += 2;
      base.secret  += 1;
      base.og      += 0; // OG muy raro
    }
    if (rebirthLevel >= 2) {
      base.common  = Math.max(0, base.common  - 5);
      base.uncommon+= 2;
      base.rare    += 2;
      base.god     += 1;
      base.secret  += 1;
    }
    if (rebirthLevel >= 3) {
      base.common  = Math.max(0, base.common  - 5);
      base.rare    += 1;
      base.god     += 1;
      base.secret  += 1;
      base.og      += 1;
    }
    return base;
  }

  function getRandomRarity() {
    const chances = getRarityChances();
    let rand = Math.random() * 100;
    let cumulative = 0;
    for (let rarity in chances) {
      cumulative += chances[rarity];
      if (rand < cumulative) return rarity;
    }
    return 'common';
  }

  function choosePet(pool, rarity) {
    const candidates = pool.filter(p => p.rarity === rarity);
    if (candidates.length === 0) return pool[0];
    return candidates[Math.floor(Math.random() * candidates.length)];
  }

  function openEgg() {
    const price = usingSpecialEgg ? specialEggPrice : normalEggPrice;
    if (money < price) {
      document.getElementById('openResult').innerHTML =
        '‚ùå <span style="color:red">¬°No tienes suficiente dinero!</span>';
      return;
    }

    money -= price;
    if (usingSpecialEgg) {
      specialEggPrice = Math.floor(specialEggPrice * 1.2);
    } else {
      normalEggPrice  = Math.floor(normalEggPrice * 1.2);
    }

    document.getElementById('money').textContent = Math.floor(money);
    document.getElementById('eggPrice').textContent =
      usingSpecialEgg ? specialEggPrice : normalEggPrice;

    const pool = usingSpecialEgg ? specialPets : normalPets;
    const rarity = getRandomRarity();
    const pet = choosePet(pool, rarity);
    ownedPets.push({...pet});

    showHatchAnimation(pet, usingSpecialEgg);
    updatePetList();
    updateIndex();
    checkRebirth();
  }

  function showHatchAnimation(pet, isSpecial) {
    const overlay = document.getElementById('hatchOverlay');
    const egg = document.getElementById('hatchEgg');
    const petIcon = document.getElementById('hatchedPetIcon');
    const petName = document.getElementById('hatchedPetName');
    const petInfo = document.getElementById('hatchedPetInfo');

    petIcon.style.display = 'none';
    egg.style.opacity = '1';
    egg.style.transform = 'scale(1)';
    egg.style.animation = 'eggIdle 1.2s infinite ease-in-out';
    overlay.style.display = 'flex';

    setTimeout(() => { egg.style.animation = 'eggShake 0.6s ease-in-out'; }, 400);
    setTimeout(() => { egg.style.animation = 'eggBreak 0.4s forwards'; }, 1100);

    setTimeout(() => {
      egg.style.opacity = '0';
      petIcon.textContent = pet.icon;
      petIcon.style.display = 'block';
      petName.textContent =
        `[#${pet.index}] ${pet.name} (${pet.rarity.toUpperCase()})`;
      petInfo.textContent =
        `+$${pet.earnings}/seg ${isSpecial ? '(Huevo especial)' : '(Huevo normal)'}`;
    }, 1500);
  }

  document.getElementById('closeHatchBtn').addEventListener('click', () => {
    document.getElementById('hatchOverlay').style.display = 'none';
  });

  function sellPet(index) {
    const pet = ownedPets[index];
    const sellPrice = pet.earnings * 6;
    money += sellPrice;
    ownedPets.splice(index, 1);
    document.getElementById('money').textContent = Math.floor(money);
    document.getElementById('openResult').innerHTML =
      `üí∞ Vendiste ${pet.name} por $${sellPrice}`;
    updatePetList();
    updateIndex();
    checkRebirth();
    setTimeout(() => { document.getElementById('openResult').innerHTML = ''; }, 2500);
  }

  function updatePetList() {
    const container = document.getElementById('petList');
    if (ownedPets.length === 0) {
      container.innerHTML =
        '<div style="color:#999; font-style:italic;">¬°Abre tu primer huevo!</div>';
      return;
    }
    const totalEarnings =
      ownedPets.reduce((sum, pet) => sum + pet.earnings, 0) * moneyMultiplier;
    container.innerHTML =
      `<div style="font-size:13px; margin-bottom:6px;">üíé Total: $${totalEarnings}/seg ` +
      `${rebirthLevel > 0 ? '(x' + moneyMultiplier + ')' : ''}</div>`;

    ownedPets.forEach((pet, i) => {
      const div = document.createElement('div');
      div.className = `pet ${pet.rarity}`;
      div.innerHTML = `
        <span>${pet.icon} [#${pet.index}] ${pet.name}</span>
        <span style="font-size:13px;">$${pet.earnings}/seg</span>
        <button class="sellBtn" onclick="sellPet(${i})">Vender</button>`;
      container.appendChild(div);
    });
  }

  function earnMoney() {
    const total =
      ownedPets.reduce((sum, pet) => sum + pet.earnings, 0) * moneyMultiplier;
    if (total > 0) {
      money += total;
      document.getElementById('money').textContent = Math.floor(money);
      checkRebirth();
    }
  }

  function checkRebirth() {
    const btn = document.getElementById('rebirthBtn');
    if (rebirthLevel >= rebirthThresholds.length) {
      btn.disabled = true;
      btn.textContent = '‚ö° REBIRTH (MAX)';
      return;
    }
    const needed = rebirthThresholds[rebirthLevel];
    btn.textContent = `‚ö° REBIRTH (${needed.toLocaleString()}$)`;
    btn.disabled = money < needed;
  }

  function doRebirth() {
    if (rebirthLevel >= rebirthThresholds.length) return;
    const needed = rebirthThresholds[rebirthLevel];
    if (money < needed) return;

    rebirthLevel += 1;
    moneyMultiplier *= 2; // por rebirth x2 (1->2->4->8)
    money = 10;
    normalEggPrice = 10;
    specialEggPrice = 500;

    document.getElementById('money').textContent = money;
    document.getElementById('eggPrice').textContent =
      usingSpecialEgg ? specialEggPrice : normalEggPrice;
    document.getElementById('openResult').innerHTML =
      `‚ö° ¬°REBIRTH ${rebirthLevel}! M√°s suerte & x${moneyMultiplier} DINERO`;
    updatePetList();
    checkRebirth();
    setTimeout(() => { document.getElementById('openResult').innerHTML = ''; }, 3000);
  }

  // INDEX (Pok√©dex)
  function getAllPets() {
    // Se podr√≠a separar por huevos, pero aqu√≠ se juntan para un index global
    return normalPets
      .map(p => ({...p, egg: 'Normal'}))
      .concat(specialPets.map(p => ({...p, egg: 'Especial'})));
  }

  function updateIndex() {
    const list = document.getElementById('indexList');
    list.innerHTML = '';
    const all = getAllPets();
    const ownedSet = new Set(ownedPets.map(p => p.icon + p.name + p.rarity));

    all.forEach(pet => {
      const key = pet.icon + pet.name + pet.rarity;
      const owned = ownedSet.has(key);
      const row = document.createElement('div');
      row.className = 'index-row' + (owned ? ' owned' : '');
      row.innerHTML = `
        <div class="index-name">${pet.icon} [#${pet.index}] ${pet.name}</div>
        <div class="index-meta">${pet.rarity.toUpperCase()} ‚Ä¢ ${pet.egg} ‚Ä¢ $${pet.earnings}/seg</div>
      `;
      list.appendChild(row);
    });
  }

  // Tabs
  const tabPetsBtn = document.getElementById('tabPetsBtn');
  const tabIndexBtn = document.getElementById('tabIndexBtn');
  const tabPets = document.getElementById('tabPets');
  const tabIndex = document.getElementById('tabIndex');

  tabPetsBtn.addEventListener('click', () => {
    tabPetsBtn.classList.add('active');
    tabIndexBtn.classList.remove('active');
    tabPets.classList.add('active');
    tabIndex.classList.remove('active');
  });

  tabIndexBtn.addEventListener('click', () => {
    tabIndexBtn.classList.add('active');
    tabPetsBtn.classList.remove('active');
    tabIndex.classList.add('active');
    tabPets.classList.remove('active');
    updateIndex();
  });

  document.getElementById('normalEgg').addEventListener('click', function() {
    usingSpecialEgg = false;
    this.classList.add('active');
    document.getElementById('specialEgg').classList.remove('active');
    document.getElementById('eggPrice').textContent = normalEggPrice;
  });

  document.getElementById('specialEgg').addEventListener('click', function() {
    usingSpecialEgg = true;
    this.classList.add('active');
    document.getElementById('normalEgg').classList.remove('active');
    document.getElementById('eggPrice').textContent = specialEggPrice;
  });

  document.getElementById('buyEggBtn').addEventListener('click', openEgg);
  document.getElementById('rebirthBtn').addEventListener('click', doRebirth);

  updatePetList();
  updateIndex();
  setInterval(earnMoney, 1000);
  checkRebirth();
</script>
</body>
</html>
