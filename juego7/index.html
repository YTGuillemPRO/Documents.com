<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Snake estilo Slither</title>
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      color: #fff;
      font-family: sans-serif;
      flex-direction: column;
    }
    canvas {
      background: #000;
      border: 2px solid #444;
    }
  </style>
</head>
<body>
  <canvas id="game" width="800" height="600"></canvas>
  <div>W/S = velocidad | A/D = girar | R = reiniciar</div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    class Snake {
      constructor(x, y, color, isPlayer = false) {
        this.x = x;
        this.y = y;
        this.angle = Math.random() * Math.PI * 2;
        this.speed = 2;
        this.turnSpeed = 0.06;
        this.length = 120; // cantidad de puntos del cuerpo
        this.trail = [];
        this.radius = 6;
        this.color = color;
        this.isPlayer = isPlayer;
        this.alive = true;
      }

      update(input, foods) {
        if (!this.alive) return;

        if (this.isPlayer) {
          if (input.left)  this.angle -= this.turnSpeed;
          if (input.right) this.angle += this.turnSpeed;
          if (input.up)    this.speed = Math.min(this.speed + 0.05, 5);
          if (input.down)  this.speed = Math.max(this.speed - 0.05, 0.5);
        } else {
          // IA muy simple: gira un poco aleatorio
          if (Math.random() < 0.03) {
            this.angle += (Math.random() - 0.5) * 0.5;
          }
        }

        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed;

        // wrap en bordes
        if (this.x < 0) this.x = canvas.width;
        if (this.x > canvas.width) this.x = 0;
        if (this.y < 0) this.y = canvas.height;
        if (this.y > canvas.height) this.y = 0;

        this.trail.unshift({ x: this.x, y: this.y });
        if (this.trail.length > this.length) {
          this.trail.pop();
        }
      }

      draw() {
        if (!this.alive) return;
        ctx.fillStyle = this.color;
        for (let i = 0; i < this.trail.length; i++) {
          const p = this.trail[i];
          const r = this.radius * (1 - i / this.trail.length);
          if (r <= 0) continue;
          ctx.beginPath();
          ctx.arc(p.x, p.y, r, 0, Math.PI * 2);
          ctx.fill();
        }
      }
    }

    class Food {
      constructor() {
        this.radius = 4;
        this.respawn();
      }
      respawn() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.color = "yellow";
      }
      draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    const keys = { up: false, down: false, left: false, right: false };

    document.addEventListener("keydown", (e) => {
      const k = e.key.toLowerCase();
      if (k === "w") keys.up = true;
      if (k === "s") keys.down = true;
      if (k === "a") keys.left = true;
      if (k === "d") keys.right = true;
      if (k === "r") reset();
    });

    document.addEventListener("keyup", (e) => {
      const k = e.key.toLowerCase();
      if (k === "w") keys.up = false;
      if (k === "s") keys.down = false;
      if (k === "a") keys.left = false;
      if (k === "d") keys.right = false;
    });

    let snakes = [];
    let foods = [];

    function reset() {
      snakes = [];
      foods = [];
      const player = new Snake(canvas.width / 2, canvas.height / 2, "lime", true);
      snakes.push(player);

      for (let i = 0; i < 4; i++) {
        snakes.push(
          new Snake(
            Math.random() * canvas.width,
            Math.random() * canvas.height,
            `hsl(${Math.random() * 360},80%,50%)`,
            false
          )
        );
      }

      for (let i = 0; i < 20; i++) {
        foods.push(new Food());
      }
    }

    function distance(a, b) {
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      return Math.sqrt(dx * dx + dy * dy);
    }

    function update() {
      snakes.forEach(s => s.update(keys, foods));

      // comer comida
      snakes.forEach(snake => {
        if (!snake.alive) return;
        foods.forEach(food => {
          if (distance(snake, food) < snake.radius + food.radius) {
            snake.length += 8; // crece
            food.respawn();
          }
        });
      });

      // colisiÃ³n entre serpientes (cabeza vs cuerpo)
      snakes.forEach(snake => {
        if (!snake.alive) return;
        snakes.forEach(other => {
          if (!other.alive) return;
          for (let i = 5; i < other.trail.length; i++) {
            const p = other.trail[i];
            if (distance({ x: snake.x, y: snake.y }, p) < snake.radius) {
              snake.alive = false;
              return;
            }
          }
        });
      });
    }

    function draw() {
      ctx.fillStyle = "#000";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      foods.forEach(f => f.draw());
      snakes.forEach(s => s.draw());
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    reset();
    loop();
  </script>
</body>
</html>
