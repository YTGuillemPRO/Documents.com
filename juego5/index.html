<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTak</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#000;color:#fff}
.app{height:100vh;display:flex;flex-direction:column}
.header{height:60px;background:#161823;display:flex;align-items:center;justify-content:space-between;padding:0 20px;flex-shrink:0}
.logo{font-size:24px;font-weight:bold}
.add-btn{background:#ff0050;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;cursor:pointer}

.feed{flex:1;overflow-y:auto;scroll-snap-type:y mandatory}
.post{height:100vh;scroll-snap-align:start;position:relative}
video{width:100%;height:100%;object-fit:cover}

.actions{position:absolute;right:20px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:20px}
.action-btn{width:50px;height:50px;border-radius:50%;border:none;font-size:22px;background:#333;color:#fff}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:999}
.modal-content{background:#161823;width:90%;max-width:400px;border-radius:20px;padding:20px;text-align:center}
button,select,input{width:100%;margin-top:10px;padding:12px;border-radius:10px;border:none;font-size:16px}
button{background:#ff0050;color:#fff}
select,input{background:#333;color:#fff}
.preview{width:100%;border-radius:10px;margin-top:10px}
</style>
</head>

<body>

<div class="app">
  <div class="header">
    <div class="logo">TikTak</div>
    <div class="add-btn" onclick="openModal()">+</div>
  </div>

  <div class="feed" id="feed"></div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>Crear video</h2>

    <video id="preview" class="preview" autoplay muted></video>

    <select id="song">
      <option value="">üéµ Sin m√∫sica</option>
      <option value="https://cdn.pixabay.com/audio/2023/08/08/audio_61b3df2f65.mp3">Trending Beat</option>
    </select>

    <input type="file" accept="video/*" onchange="uploadFromGallery(this)">
    <button onclick="startRecording()">üî¥ Grabar</button>
    <button onclick="stopRecording()">‚èπ Detener</button>
    <button onclick="closeModal()" style="background:#444">Cancelar</button>
  </div>
</div>

<script>
let stream, recorder, chunks=[]
let music=new Audio()

const botVideos=[
 "https://cdn.coverr.co/videos/coverr-dancing-girl-5174/1080p.mp4",
 "https://cdn.coverr.co/videos/coverr-happy-dog-5408/1080p.mp4",
 "https://cdn.coverr.co/videos/coverr-friends-laughing-5176/1080p.mp4"
]

// cargar videos de bots
botVideos.forEach(v=>addVideo(v))

function addVideo(src){
  const post=document.createElement("div")
  post.className="post"
  post.innerHTML=`
    <video src="${src}" autoplay loop></video>
    <div class="actions">
      <button class="action-btn">‚ù§Ô∏è</button>
      <button class="action-btn">üí¨</button>
      <button class="action-btn">üéµ</button>
    </div>`
  document.getElementById("feed").appendChild(post)
}

function openModal(){
  document.getElementById("modal").style.display="flex"
  navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(s=>{
      stream=s
      document.getElementById("preview").srcObject=s
    })
}

function closeModal(){
  document.getElementById("modal").style.display="none"
  if(stream) stream.getTracks().forEach(t=>t.stop())
  music.pause()
}

function startRecording(){
  const song=document.getElementById("song").value
  if(song){ music.src=song; music.play() }

  recorder=new MediaRecorder(stream)
  chunks=[]
  recorder.start()

  recorder.ondataavailable=e=>chunks.push(e.data)
  recorder.onstop=()=>{
    const blob=new Blob(chunks,{type:"video/mp4"})
    addVideo(URL.createObjectURL(blob))
    closeModal()
  }
}

function stopRecording(){
  if(recorder) recorder.stop()
}

function uploadFromGallery(input){
  const file=input.files[0]
  if(file){
    addVideo(URL.createObjectURL(file))
    closeModal()
  }
}
</script>

</body>
</html>
