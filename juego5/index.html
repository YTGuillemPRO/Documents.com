<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TikTak - Grabaci√≥n con M√∫sica</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial;background:#000;color:#fff;overflow:hidden}
.app{height:100vh;display:flex;flex-direction:column}
.header{height:60px;background:#161823;display:flex;align-items:center;justify-content:space-between;padding:0 20px}
.logo{font-size:24px;font-weight:bold}
.add-btn{background:#ff0050;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;cursor:pointer}
.content{flex:1;position:relative}
video{width:100%;height:100%;object-fit:cover}

.actions{position:absolute;right:20px;top:50%;transform:translateY(-50%);display:flex;flex-direction:column;gap:20px}
.action-btn{width:50px;height:50px;border-radius:50%;border:none;font-size:22px;background:#333;color:#fff;cursor:pointer}
.like-btn.liked{background:#ff0050}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:999}
.modal-content{background:#161823;width:90%;max-width:400px;border-radius:20px;padding:20px;text-align:center}
button,select,input,textarea{width:100%;margin-top:10px;padding:12px;border-radius:10px;border:none;font-size:16px}
button{background:#ff0050;color:#fff;cursor:pointer}
select,input,textarea{background:#333;color:#fff}
.preview{width:100%;border-radius:10px;margin-top:10px}
</style>
</head>

<body>

<div class="app">
  <div class="header">
    <div class="logo">TikTak</div>
    <div class="add-btn" onclick="openModal()">+</div>
  </div>

  <div class="content">
    <video id="feedVideo" autoplay loop muted></video>
    <div class="actions">
      <button class="action-btn like-btn" onclick="toggleLike()">ü§ç</button>
      <button class="action-btn">üí¨</button>
      <button class="action-btn">üéµ</button>
    </div>
  </div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h2>Crear video</h2>

    <video id="preview" class="preview" autoplay muted></video>

    <select id="song">
      <option value="">üéµ Elegir canci√≥n</option>
      <option value="https://cdn.pixabay.com/audio/2022/03/15/audio_8baf93b73b.mp3">
        Makeba (TikTok Style)
      </option>
      <option value="https://cdn.pixabay.com/audio/2023/03/30/audio_1735e3f0ff.mp3">
        Flowers - Pop
      </option>
      <option value="https://cdn.pixabay.com/audio/2023/04/12/audio_7fa2c07e55.mp3">
        Dance Viral
      </option>
      <option value="https://cdn.pixabay.com/audio/2023/08/08/audio_61b3df2f65.mp3">
        Trending Beat
      </option>
    </select>

    <input placeholder="Usuario" value="@usuario">
    <textarea placeholder="Descripci√≥n"></textarea>

    <button onclick="startRecording()">üî¥ Grabar</button>
    <button onclick="stopRecording()">‚èπ Detener</button>
    <button onclick="closeModal()" style="background:#444">Cancelar</button>
  </div>
</div>

<script>
let stream, recorder, chunks=[]
let liked=false
let music=new Audio()

function openModal(){
  document.getElementById("modal").style.display="flex"
  navigator.mediaDevices.getUserMedia({video:true,audio:true})
    .then(s=>{
      stream=s
      document.getElementById("preview").srcObject=s
    })
}

function closeModal(){
  document.getElementById("modal").style.display="none"
  if(stream) stream.getTracks().forEach(t=>t.stop())
  music.pause()
}

function startRecording(){
  const song=document.getElementById("song").value
  if(song){
    music.src=song
    music.loop=true
    music.play()
  }

  recorder=new MediaRecorder(stream)
  recorder.start()
  chunks=[]

  recorder.ondataavailable=e=>chunks.push(e.data)
  recorder.onstop=()=>{
    const blob=new Blob(chunks,{type:"video/mp4"})
    const url=URL.createObjectURL(blob)
    const video=document.getElementById("feedVideo")
    video.src=url
    video.muted=false
    music.pause()
    closeModal()
  }
}

function stopRecording(){
  if(recorder && recorder.state==="recording") recorder.stop()
}

function toggleLike(){
  liked=!liked
  const btn=document.querySelector(".like-btn")
  btn.textContent=liked?"‚ù§Ô∏è":"ü§ç"
  btn.classList.toggle("liked",liked)
}
</script>

</body>
</html>
