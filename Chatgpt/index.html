<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IA Inteligente Offline</title>
  <style>
    :root {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #e0e0e0;
      --accent: #bb86fc;
      --user: #3700b3;
      --ai: #2c2c2c;
    }

    body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      background: var(--bg); color: var(--text);
      margin: 0; display: flex; flex-direction: column; height: 100vh; 
    }

    header { padding: 15px; background: var(--card); text-align: center; border-bottom: 2px solid var(--accent); font-weight: bold; }

    #chat { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }

    .msg { max-width: 85%; padding: 12px; border-radius: 12px; line-height: 1.4; position: relative; }
    .user { align-self: flex-end; background: var(--user); border-bottom-right-radius: 2px; }
    .ai { align-self: flex-start; background: var(--ai); border-bottom-left-radius: 2px; border-left: 3px solid var(--accent); }

    #input-container { display: flex; padding: 15px; background: var(--card); gap: 10px; }
    #input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #252525; color: white; outline: none; }
    #btn-send { padding: 0 20px; border: none; border-radius: 8px; background: var(--accent); color: black; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>

  <header id="header-name">IA CEREBRO v3</header>
  <div id="chat"></div>

  <div id="input-container">
    <input type="text" id="input" placeholder="Escribe algo (aunque tengas faltas)..." autocomplete="off">
    <button id="btn-send">Enviar</button>
  </div>

  <script>
    /* ================= BASE DE CONOCIMIENTO (HISTORIA Y PAÍSES) ================= */
    const CONOCIMIENTO = {
      // Geografía
      "españa": "País de Europa. Capital: Madrid. Moneda: Euro.",
      "mexico": "País de América. Capital: CDMX. Moneda: Peso Mexicano.",
      "francia": "País de Europa. Capital: París. Famoso por la Torre Eiffel.",
      "argentina": "País de América del Sur. Capital: Buenos Aires. Cuna del Tango.",
      
      // Historia
      "revolucion francesa": "Conflicto social y político (1789) que derrocó la monarquía en Francia y estableció derechos ciudadanos.",
      "segunda guerra mundial": "Guerra global (1939-1945) entre Aliados y Potencias del Eje. Terminó con la derrota de la Alemania nazi.",
      "imperio romano": "Una de las civilizaciones más grandes de la historia, centrada en Roma, dominó el Mediterráneo por siglos.",
      "descubrimiento de america": "Llegada de Cristóbal Colón en 1492, conectando Europa con el nuevo continente.",
      "egipto antiguo": "Civilización famosa por sus pirámides, faraones y el río Nilo.",
      "independencia de mexico": "Proceso que inició en 1810 para liberarse del dominio español.",
      
      // Conceptos simples
      "hola": "¡Hola! ¿Cómo estás?",
      "quien eres": "Soy tu asistente inteligente offline con conocimientos de historia y geografía.",
      "gracias": "¡De nada! Es un placer ayudarte.",
      "adios": "¡Hasta pronto! Cuídate mucho."
    };

    /* ================= MOTOR DE COMPRENSIÓN (FUZZY LOGIC) ================= */
    // Función para limpiar texto y manejar errores de ortografía simples
    function normalizar(texto) {
      return texto.toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Quitar tildes
        .replace(/[y]/g, "i") // Intercambiar i/y común
        .replace(/[v]/g, "b") // Intercambiar b/v común
        .replace(/[h]/g, "")  // Quitar h (error común)
        .replace(/[^a-z0-9 ]/g, ""); // Quitar símbolos
    }

    // Calcula similitud entre palabras para entender si hay letras mal
    function calcularSimilitud(s1, s2) {
      if (s1.includes(s2) || s2.includes(s1)) return true;
      // Lógica simple: si comparten más del 70% de las letras en orden
      let coincidencias = 0;
      let minLen = Math.min(s1.length, s2.length);
      for(let i=0; i<minLen; i++) { if(s1[i] === s2[i]) coincidencias++; }
      return (coincidencias / s1.length) > 0.7;
    }

    /* ================= LÓGICA DE RESPUESTA ================= */
    let memoriaExtra = JSON.parse(localStorage.getItem("ia_pro_mem")) || {};

    function pensar(inputUsuario) {
      const original = inputUsuario.toLowerCase();
      const limpia = normalizar(inputUsuario);

      // 1. Buscar en Conocimiento Estático (Historia/Países)
      for (let clave in CONOCIMIENTO) {
        let claveLimpia = normalizar(clave);
        if (limpia.includes(claveLimpia) || calcularSimilitud(limpia, claveLimpia)) {
          return CONOCIMIENTO[clave];
        }
      }

      // 2. Buscar en Memoria Aprendida
      for (let k in memoriaExtra) {
        if (limpia.includes(normalizar(k))) return memoriaExtra[k];
      }

      // 3. Comandos de aprendizaje
      if (original.includes("aprende que") && original.includes(" es ")) {
        let partes = original.split("aprende que")[1].split(" es ");
        memoriaExtra[partes[0].trim()] = partes[1].trim();
        localStorage.setItem("ia_pro_mem", JSON.stringify(memoriaExtra));
        return "He guardado ese dato en mi memoria a largo plazo.";
      }

      // 4. Matemáticas (Reutilizado y mejorado)
      try {
        let op = original.replace(/x/g, "*").replace(/[^0-9+\-*/(). ]/g, "");
        if (op.length > 2) {
          let res = eval(op);
          if (!isNaN(res)) return "El resultado matemático es: " + res;
        }
      } catch(e) {}

      return "No estoy seguro de entenderte (recuerda que soy offline). ¿Puedes repetirlo o enseñarme con 'aprende que...'?";
    }

    /* ================= INTERFAZ ================= */
    const chatBox = document.getElementById("chat");
    const inputField = document.getElementById("input");

    function addMsg(quien, texto, clase) {
      const d = document.createElement("div");
      d.className = `msg ${clase}`;
      d.innerHTML = `<b>${quien}</b><br>${texto}`;
      chatBox.appendChild(d);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function enviar() {
      const txt = inputField.value.trim();
      if (!txt) return;
      addMsg("Tú", txt, "user");
      setTimeout(() => addMsg("IA", pensar(txt), "ai"), 400);
      inputField.value = "";
    }

    document.getElementById("btn-send").onclick = enviar;
    inputField.onkeydown = (e) => { if(e.key === "Enter") enviar(); };

    addMsg("IA", "¡Hola! Entiendo de historia, países y matemáticas. No te preocupes si escribes con faltas, ¡intentaré entenderte!", "ai");
  </script>
</body>
</html>
